<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color: #000;
      background: #fff;
    }

    /* Make embedding inside Notion/iframes behave */
    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 24px;
      background: #fff;
    }

    .card {
      max-width: 680px;
      margin: 0 auto;
      border: 1px solid #e6e6e6;
      border-radius: 14px;
      background: #fff;

      /* Outer padding so nothing can touch edges */
      padding: 18px;
    }

    h2 {
      font-size: 25px;
      margin: 0 0 14px;
      letter-spacing: 0.1px;
      color: #000;
      font-weight: 700;
    }

    /* Inner layout wrapper: gives consistent breathing room */
    .content {
      display: grid;
      gap: 14px;
    }

    /* 2-column grid for the two editable inputs */
    .grid2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }

    .field {
      display: grid;
      gap: 6px;

      /* This is the key: inner padding around each field block */
      padding: 6px 6px;
      border-radius: 12px;
    }

    label {
      font-size: 13px;
      color: #333;
    }

    input {
      width: 100%;
      padding: 12px 12px;     /* input height */
      border-radius: 10px;
      border: 1px solid #d9d9d9;
      font-size: 14px;
      background: #fff;
      outline: none;
    }
    
    #today {
      text-align: center;
    }
    
    #renewal {
      text-align: center;
    }
    
    #annual {
      text-align: center;
    }

    input:focus {
      border-color: #bdbdbd;
      box-shadow: 0 0 0 3px rgba(0,0,0,0.06);
    }

    input[disabled] {
      background: #fafafa;
      color: #666;
      cursor: not-allowed;
    }

    .pill {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      background: #f0f0f0;
      border: 1px solid #e5e5e5;
      font-size: 12px;
      color: #444;
      margin-left: 6px;
      vertical-align: middle;
    }

    .out {
      border: 1px solid #eee;
      background: #fafafa;
      border-radius: 14px;
      padding: 14px;

      display: grid;
      gap: 10px;
    }

    .big {
      font-size: 24px;
      font-weight: 750;
      margin: 0;
      color: #000; /* force output amount to black */
    }

    .muted {
      font-size: 12px;
      color: #999;
      line-height: 1.35;
    }

    .rowline {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    .kpi {
      display: inline-flex;
      align-items: baseline;
      gap: 8px;
      font-size: 12px;
      color: #555;
    }

    .kpi b {
      font-size: 13px;
      color: #222;
    }

    .btns {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    button {
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid #d9d9d9;
      background: #fff;
      cursor: pointer;
      font-size: 14px;
    }
    
    .reset-btn {
      padding: 5px 10px;        /* smaller hitbox */
      font-size: 12px;          /* leaner text */
      border-radius: 8px;
      background: transparent; /* less visual weight */
      color: #444;
      border: 1px solid #e0e0e0;
    }

.reset-btn:hover {
  background: #f2f2f2;
}

    button:hover { background: #f7f7f7; }

    .hint {
      font-size: 12px;
      color: #999;
      margin-top: 2px;
    }

    @media (max-width: 620px) {
      body { padding: 16px; }
      .grid2 { grid-template-columns: 1fr; }
      .card { padding: 16px; }
    }
  </style>
</head>
<body>
  <div class="card">
    <h2>Prorated Amount Due Calculator</h2>

    <div class="content">
      <!-- SIDE-BY-SIDE EDITABLE INPUTS -->
      <div class="grid2">
        <div class="field">
          <label for="annual">Total Annual Upsell Amount ($)</label>
          <input id="annual" type="number" min="0" step="0.01" inputmode="decimal" placeholder="e.g., 2400" />
        </div>

        <div class="field">
          <label for="renewal">Contract Renewal Date</label>
          <input id="renewal" type="date" />
        </div>
      </div>

      <!-- TODAY (READ ONLY) -->
      <div class="field">
        <label for="today">Today <span class="pill" id="tzpill"></span></label>
        <input id="today" type="date" />
        <div class="hint">Proration uses today → day before renewal.</div>
      </div>

      <!-- OUTPUT -->
      <div class="out">
        <div class="big" id="amount">$0.00</div>

        <div class="muted" id="formulaLine">Formula: (0 ÷ 365) × 0</div>

        <div class="rowline">
          <div class="kpi">Days prorated: <b id="days">0</b></div>
          <button id="reset" class="reset-btn" type="button">Reset</button>
        </div>  <!-- .content -->
       </div>  <!-- .card -->
      </body>

  <script>
    const $ = (id) => document.getElementById(id);

    // Avoid UTC date shifts with <input type="date">
    function toLocalISODate(d) {
      const off = d.getTimezoneOffset();
      const local = new Date(d.getTime() - off * 60 * 1000);
      return local.toISOString().slice(0, 10);
    }

    function parseLocalDate(v) {
      if (!v) return null;
      const [y, m, d] = v.split("-").map(Number);
      return new Date(y, m - 1, d); // local midnight
    }

    function diffDays(a, b) {
      // whole-day difference: a - b
      return Math.floor((a.getTime() - b.getTime()) / 86400000);
    }

    function formatUSD(n) {
      return new Intl.NumberFormat(undefined, {
        style: "currency",
        currency: "USD",
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      }).format(n);
    }

    function formatNumber(n) {
      return new Intl.NumberFormat(undefined, {
        minimumFractionDigits: 0,
        maximumFractionDigits: 2
      }).format(n);
    }

    const annualEl = $("annual");
    const renewalEl = $("renewal");
    const todayEl = $("today");
    const tzpill = $("tzpill");

    const daysEl = $("days");
    const amountEl = $("amount");
    const formulaLineEl = $("formulaLine");

    function setToday() {
      todayEl.value = toLocalISODate(new Date());
      tzpill.textContent = Intl.DateTimeFormat().resolvedOptions().timeZone || "Local";
    }

    function calculate() {
      const annual = Number(annualEl.value || 0);
      const today = parseLocalDate(todayEl.value);
      const renewal = parseLocalDate(renewalEl.value);

      // Day before renewal
      let days = 0;
      if (today && renewal) {
        const end = new Date(renewal.getTime());
        end.setDate(end.getDate() - 1);
        days = diffDays(end, today);
        if (days < 0) days = 0;
      }

      const dailyRate = annual / 365;
      const prorated = dailyRate * days;

      daysEl.textContent = String(days);
      amountEl.textContent = formatUSD(isFinite(prorated) ? prorated : 0);

      formulaLineEl.textContent =
        `Formula: (${formatNumber(annual)} ÷ 365) × ${days}`;
    }

    function reset() {
      annualEl.value = "";
      renewalEl.value = "";
      setToday();
      calculate();
    }

    async function copyResult() {
      const text = `Prorated Amount: ${amountEl.textContent} (Days: ${daysEl.textContent})`;
      try {
        await navigator.clipboard.writeText(text);
        $("copy").textContent = "Copied";
        setTimeout(() => $("copy").textContent = "Copy result", 900);
      } catch {
        // Fallback: do nothing if clipboard blocked
        $("copy").textContent = "Copy failed";
        setTimeout(() => $("copy").textContent = "Copy result", 900);
      }
    }

    // Init
    setToday();
    calculate();

    // Events
    annualEl.addEventListener("input", calculate);
    renewalEl.addEventListener("input", calculate);
    todayEl.addEventListener("input", calculate);
    $("reset").addEventListener("click", reset);
  </script>
</body>
</html>
